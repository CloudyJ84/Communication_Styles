import React, { useState, useEffect } from 'react';
import { ArrowRight, CheckCircle, RefreshCw, Info, BarChart2, ChevronRight, GripVertical } from 'lucide-react';

// --- Data & Content ---

// Mapped based on PDF definitions and standard DISC/Color models
// B=Blue(Analytical), G=Green(Feeler), Y=Yellow(Influencing), R=Red(Driver)
const QUESTIONS = [
    { id: 1, words: [
        { text: "Accurate", color: "blue", def: "Precise, correct, careful" },
        { text: "Patient", color: "green", def: "Tolerant, understanding" },
        { text: "Gregarious", color: "yellow", def: "Sociable, outgoing" },
        { text: "Direct", color: "red", def: "Candid, straightforward" }
    ]},
    { id: 2, words: [
        { text: "Systematic", color: "blue", def: "Methodical, organized" },
        { text: "Loyal", color: "green", def: "Trustworthy, dedicated" },
        { text: "Persuasive", color: "yellow", def: "Convincing, seeks to influence" },
        { text: "Daring", color: "red", def: "Bold, willing to try new things" }
    ]},
    { id: 3, words: [
        { text: "Aloof", color: "blue", def: "Standoffish, doesn't initiate" },
        { text: "Passive", color: "green", def: "Uninvolved, disinterested" },
        { text: "Impulsive", color: "yellow", def: "Enthusiastic, unrestrained" },
        { text: "Stubborn", color: "red", def: "Rigid, determined" }
    ]},
    { id: 4, words: [
        { text: "Mature", color: "blue", def: "Developed, seasoned" },
        { text: "Stable", color: "green", def: "Reliable, consistent" },
        { text: "Confident", color: "yellow", def: "Self-assured, unafraid" },
        { text: "Self-reliant", color: "red", def: "Comfortable depending on oneself" }
    ]},
    { id: 5, words: [
        { text: "Conventional", color: "blue", def: "Typical, traditional" },
        { text: "Serene", color: "green", def: "Peaceful, calm" },
        { text: "Self-promoting", color: "yellow", def: "Assertive, political" },
        { text: "Forceful", color: "red", def: "Powerful, effective" }
    ]},
    { id: 6, words: [
        { text: "Restrained", color: "blue", def: "Moderate, controlled" },
        { text: "Even-tempered", color: "green", def: "Calm, level-headed" },
        { text: "Charming", color: "yellow", def: "Appealing, engaging" },
        { text: "Quick", color: "red", def: "Abrupt, brief" }
    ]},
    { id: 7, words: [
        { text: "Practical", color: "blue", def: "Sensible, reasonable" },
        { text: "Predictable", color: "green", def: "Consistent, does the expected" },
        { text: "Emotional", color: "yellow", def: "Sensitive, demonstrative" },
        { text: "Bold", color: "red", def: "Courageous, fearless" }
    ]},
    { id: 8, words: [
        { text: "Intelligent", color: "blue", def: "Smart, knowledgeable" },
        { text: "Creative", color: "green", def: "Innovative, clever" }, 
        { text: "Colorful", color: "yellow", def: "Distinctive, lively" },
        { text: "Competent", color: "red", def: "Qualified, capable" } 
    ]},
    { id: 9, words: [
        { text: "Evaluative", color: "blue", def: "Assesses, judges" },
        { text: "Devout", color: "green", def: "Faithful, sincere" },
        { text: "Passionate", color: "yellow", def: "Excited, enthusiastic" },
        { text: "Risk taker", color: "red", def: "Adventurous, not cautious" }
    ]},
    { id: 10, words: [
        { text: "Humble", color: "blue", def: "Modest, respectful" },
        { text: "Gentle", color: "green", def: "Nice, pleasant" },
        { text: "Optimistic", color: "yellow", def: "Positive, hopeful" },
        { text: "Self-directed", color: "red", def: "Independent" }
    ]},
    { id: 11, words: [
        { text: "Perfectionist", color: "blue", def: "Demands excellence" },
        { text: "Easy mark", color: "green", def: "Easily misled, pushover" },
        { text: "Talkative", color: "yellow", def: "Outgoing, communicative" },
        { text: "Law-abiding", color: "red", def: "Conscientious, honorable" } 
    ]},
    { id: 12, words: [
        { text: "Cautious", color: "blue", def: "Careful, guarded" },
        { text: "Good listener", color: "green", def: "Attentive, patient" },
        { text: "Obliging", color: "yellow", def: "Agreeable, accommodating" },
        { text: "Respectful", color: "red", def: "Polite, considerate" }
    ]},
    { id: 13, words: [
        { text: "Moderate", color: "blue", def: "Balanced, reasonable" },
        { text: "Content", color: "green", def: "Satisfied, comfortable" },
        { text: "High-spirited", color: "yellow", def: "Lively, eager" },
        { text: "Neighborly", color: "red", def: "Friendly, sociable" } 
    ]},
    { id: 14, words: [
        { text: "Good Mixer", color: "blue", def: "Works easily with others" }, 
        { text: "Popular", color: "green", def: "Generally liked" },
        { text: "Playful", color: "yellow", def: "Spirited, fun-loving" },
        { text: "Impatient", color: "red", def: "Intolerant, easily irritated" }
    ]},
    { id: 15, words: [
        { text: "Experimental", color: "blue", def: "Innovative, pioneering" },
        { text: "Restless", color: "green", def: "Anxious, unsettled" }, 
        { text: "Outspoken", color: "yellow", def: "Blunt, candid" },
        { text: "Competitive", color: "red", def: "Ambitious, striving" }
    ]}
];

const STYLES = {
    blue: {
        name: "Analytical",
        title: "The Thinker",
        color: "bg-blue-500",
        text: "text-blue-600",
        border: "border-blue-500",
        bgLight: "bg-blue-50",
        desc: "Detailed, specialized, focused, seeks perfection.",
        strengths: "Precise, efficient, handles details others consider boring.",
        weaknesses: "May appear cool and impersonal, nit-picking, slow to deliver product.",
        likes: "Detail and precision.",
        fear: "Embarrassment, appearing incompetent."
    },
    green: {
        name: "Feeler",
        title: "The Supporter",
        color: "bg-green-500",
        text: "text-green-600",
        border: "border-green-500",
        bgLight: "bg-green-50",
        desc: "Loyal, consistent, good listener, patient, peacemaker.",
        strengths: "Well balanced, good with people and tasks, dependable, understanding.",
        weaknesses: "May be oversensitive, possessive, resentful.",
        likes: "To be helpful and build trust.",
        fear: "Confrontation and sudden change."
    },
    yellow: {
        name: "Influencing",
        title: "The Entertainer",
        color: "bg-yellow-400",
        text: "text-yellow-600",
        border: "border-yellow-400",
        bgLight: "bg-yellow-50",
        desc: "Playful, loves variety, spontaneous, flexible.",
        strengths: "Enthusiastic, fun to be with, wins people over, adaptable, sees big picture.",
        weaknesses: "May come on too strong, unpredictable, disorganized, too trusting.",
        likes: "The spotlight, ideas, opinions.",
        fear: "Loss of prestige, approval."
    },
    red: {
        name: "Driver",
        title: "The Controller",
        color: "bg-red-500",
        text: "text-red-600",
        border: "border-red-500",
        bgLight: "bg-red-50",
        desc: "Strong, competitive, forceful, decisive.",
        strengths: "Direct, assertive, bottom-line, accomplishes a lot quickly, loves challenge.",
        weaknesses: "Can appear abrasive and intense, impatient.",
        likes: "Being in charge, getting to the point.",
        fear: "Loss of control, being taken advantage of."
    }
};

// --- Components ---

const Card = ({ children, className = "" }) => (
    <div className={`bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden ${className}`}>
        {children}
    </div>
);

// Drag and Drop Row Component
const DraggableRow = ({ question, onRankChange, currentOrder }) => {
    // Local state for dragging visual feedback
    const [items, setItems] = useState(currentOrder || question.words);

    useEffect(() => {
        if(currentOrder) setItems(currentOrder);
    }, [currentOrder]);

    // Simple swap-based drag logic for mobile/desktop compatibility without heavy libs
    const moveItem = (fromIndex, toIndex) => {
        const updatedItems = [...items];
        const [movedItem] = updatedItems.splice(fromIndex, 1);
        updatedItems.splice(toIndex, 0, movedItem);
        setItems(updatedItems);
        onRankChange(question.id, updatedItems);
    };

    return (
        <div className="mb-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
            <h3 className="text-lg font-medium text-slate-700 mb-3">
                Row {question.id} <span className="text-sm font-normal text-slate-400 ml-2">(Top = Most like you)</span>
            </h3>
            <div className="flex flex-col space-y-2">
                {items.map((word, index) => (
                    <div 
                        key={word.text}
                        className="relative group flex items-center justify-between p-3 bg-white border border-slate-200 rounded-lg hover:border-indigo-300 transition-colors cursor-grab active:cursor-grabbing select-none"
                    >
                        <div className="flex items-center gap-3">
                            <span className={`
                                flex items-center justify-center w-6 h-6 rounded-full text-xs font-bold
                                ${index === 0 ? 'bg-indigo-600 text-white' : 'bg-slate-100 text-slate-500'}
                            `}>
                                {4 - index}
                            </span>
                            <div>
                                <span className="font-semibold text-slate-800 block">{word.text}</span>
                                <span className="text-xs text-slate-500">{word.def}</span>
                            </div>
                        </div>
                        
                        {/* Up/Down Controls */}
                        <div className="flex flex-col gap-1 opacity-10 md:opacity-100 md:group-hover:opacity-100 transition-opacity">
                            {index > 0 && (
                                <button 
                                    onClick={() => moveItem(index, index - 1)}
                                    className="p-1 hover:bg-slate-100 rounded text-slate-500"
                                >
                                    <ChevronRight className="rotate-[-90deg]" size={16}/>
                                </button>
                            )}
                            {index < 3 && (
                                <button 
                                    onClick={() => moveItem(index, index + 1)}
                                    className="p-1 hover:bg-slate-100 rounded text-slate-500"
                                >
                                    <ChevronRight className="rotate-[90deg]" size={16}/>
                                </button>
                            )}
                        </div>
                    </div>
                ))}
            </div>
        </div>
    );
};

// Results View
const Results = ({ scores, onReset }) => {
    const total = scores.blue + scores.green + scores.yellow + scores.red;
    
    // Determine dominant style
    const dominantKey = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
    const style = STYLES[dominantKey];

    // Calculate chart segments
    // Conic gradient logic: Blue starts at 0.
    const bPct = (scores.blue / total) * 100;
    const gPct = (scores.green / total) * 100;
    const yPct = (scores.yellow / total) * 100;
    const rPct = (scores.red / total) * 100;

    return (
        <div className="max-w-2xl mx-auto p-4 animate-in zoom-in duration-500">
            <Card className="p-6 mb-6 text-center">
                <h2 className="text-2xl font-bold text-slate-800 mb-2">Your Dominant Style</h2>
                <div className={`inline-block px-4 py-1 rounded-full text-sm font-bold uppercase tracking-wide mb-6 ${style.bgLight} ${style.text}`}>
                    {style.name}
                </div>
                
                <div className="flex justify-center mb-8 relative">
                    {/* CSS Conic Gradient Chart */}
                    <div 
                        className="w-48 h-48 rounded-full shadow-inner relative"
                        style={{
                            background: `conic-gradient(
                                #3b82f6 0% ${bPct}%, 
                                #22c55e ${bPct}% ${bPct + gPct}%, 
                                #facc15 ${bPct + gPct}% ${bPct + gPct + yPct}%, 
                                #ef4444 ${bPct + gPct + yPct}% 100%
                            )`
                        }}
                    >
                        <div className="absolute inset-4 bg-white rounded-full flex items-center justify-center flex-col">
                            <span className="text-3xl font-bold text-slate-700">{Math.round((scores[dominantKey]/total)*100)}%</span>
                            <span className="text-xs text-slate-400 uppercase">{dominantKey}</span>
                        </div>
                    </div>
                </div>

                <div className="grid grid-cols-4 gap-2 text-center text-sm mb-6">
                    <div className="p-2 bg-blue-50 rounded">
                        <div className="font-bold text-blue-600">{scores.blue}</div>
                        <div className="text-xs text-blue-400">Analytical</div>
                    </div>
                    <div className="p-2 bg-green-50 rounded">
                        <div className="font-bold text-green-600">{scores.green}</div>
                        <div className="text-xs text-green-400">Feeler</div>
                    </div>
                    <div className="p-2 bg-yellow-50 rounded">
                        <div className="font-bold text-yellow-600">{scores.yellow}</div>
                        <div className="text-xs text-yellow-400">Influencing</div>
                    </div>
                    <div className="p-2 bg-red-50 rounded">
                        <div className="font-bold text-red-600">{scores.red}</div>
                        <div className="text-xs text-red-400">Driver</div>
                    </div>
                </div>
            </Card>

            <Card className="p-6 mb-6">
                <h3 className={`text-xl font-bold mb-4 ${style.text} flex items-center gap-2`}>
                    <Info size={20}/> About Your Style: {style.title}
                </h3>
                <p className="text-slate-600 mb-4 italic">"{style.desc}"</p>
                
                <div className="grid md:grid-cols-2 gap-6">
                    <div>
                        <h4 className="font-semibold text-slate-800 mb-2">Strengths</h4>
                        <p className="text-sm text-slate-600 leading-relaxed">{style.strengths}</p>
                    </div>
                    <div>
                        <h4 className="font-semibold text-slate-800 mb-2">Room to Grow</h4>
                        <p className="text-sm text-slate-600 leading-relaxed">{style.weaknesses}</p>
                    </div>
                    <div>
                        <h4 className="font-semibold text-slate-800 mb-2">Likes</h4>
                        <p className="text-sm text-slate-600 leading-relaxed">{style.likes}</p>
                    </div>
                    <div>
                        <h4 className="font-semibold text-slate-800 mb-2">Fears</h4>
                        <p className="text-sm text-slate-600 leading-relaxed">{style.fear}</p>
                    </div>
                </div>
            </Card>

            <button 
                onClick={onReset}
                className="w-full py-4 bg-slate-800 text-white rounded-xl font-semibold hover:bg-slate-700 transition-colors flex items-center justify-center gap-2"
            >
                <RefreshCw size={18} /> Retake Assessment
            </button>
        </div>
    );
};

// Main App
const App = () => {
    const [started, setStarted] = useState(false);
    const [finished, setFinished] = useState(false);
    const [answers, setAnswers] = useState({});
    const [currentPage, setCurrentPage] = useState(0);
    
    // Pagination logic: 5 questions per page
    const QUESTIONS_PER_PAGE = 5;
    const totalPages = Math.ceil(QUESTIONS.length / QUESTIONS_PER_PAGE);
    const currentQuestions = QUESTIONS.slice(currentPage * QUESTIONS_PER_PAGE, (currentPage + 1) * QUESTIONS_PER_PAGE);

    const handleRankChange = (questionId, orderedWords) => {
        setAnswers(prev => ({
            ...prev,
            [questionId]: orderedWords
        }));
    };

    const calculateScores = () => {
        const scores = { blue: 0, green: 0, yellow: 0, red: 0 };
        
        Object.values(answers).forEach(row => {
            // row is array of words. Index 0 = 4 pts, Index 1 = 3 pts, etc.
            row.forEach((word, index) => {
                const points = 4 - index;
                if (scores[word.color] !== undefined) {
                    scores[word.color] += points;
                }
            });
        });
        return scores;
    };

    const handleNext = () => {
        if (currentPage < totalPages - 1) {
            setCurrentPage(prev => prev + 1);
            window.scrollTo(0, 0);
        } else {
            setFinished(true);
            window.scrollTo(0, 0);
        }
    };

    const handleReset = () => {
        setStarted(false);
        setFinished(false);
        setAnswers({});
        setCurrentPage(0);
    };

    // Check if all questions on current page are answered
    const canProceed = currentQuestions.every(q => answers[q.id]);

    if (finished) {
        return <Results scores={calculateScores()} onReset={handleReset} />;
    }

    if (!started) {
        return (
            <div className="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-indigo-50 to-blue-100">
                <Card className="max-w-md w-full p-8 text-center">
                    <div className="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-6">
                        <BarChart2 className="text-indigo-600" size={32} />
                    </div>
                    <h1 className="text-3xl font-bold text-slate-900 mb-4">Communication Style</h1>
                    <p className="text-slate-600 mb-8 leading-relaxed">
                        Understand your strengths and how you perceive others. Rank word groups to discover if you are an Analytical, Driver, Feeler, or Influencer.
                    </p>
                    <button 
                        onClick={() => setStarted(true)}
                        className="w-full py-4 bg-indigo-600 text-white rounded-xl font-semibold shadow-lg hover:bg-indigo-700 hover:shadow-xl transition-all transform hover:-translate-y-1 flex items-center justify-center gap-2"
                    >
                        Start Assessment <ArrowRight size={18} />
                    </button>
                    <p className="mt-4 text-xs text-slate-400">Takes about 3 minutes</p>
                </Card>
            </div>
        );
    }

    return (
        <div className="min-h-screen pb-20 font-sans bg-slate-50">
             <style>{`
                /* Inject custom styles for no-scrollbar if needed, though Tailwind usually handles layout well enough */
                .no-scrollbar::-webkit-scrollbar { display: none; }
                .no-scrollbar { -ms-overflow-style: none;  scrollbar-width: none; }
            `}</style>
            <div className="sticky top-0 z-40 bg-white/80 backdrop-blur-md border-b border-slate-200 px-4 py-4">
                <div className="max-w-2xl mx-auto flex items-center justify-between">
                    <h2 className="font-semibold text-slate-800">Step {currentPage + 1} of {totalPages}</h2>
                    <div className="text-sm text-slate-500">
                        {Object.keys(answers).length} / {QUESTIONS.length} Answered
                    </div>
                </div>
                {/* Progress Bar */}
                <div className="max-w-2xl mx-auto mt-3 h-1 bg-slate-100 rounded-full overflow-hidden">
                    <div 
                        className="h-full bg-indigo-500 transition-all duration-500"
                        style={{ width: `${(Object.keys(answers).length / QUESTIONS.length) * 100}%` }}
                    />
                </div>
            </div>

            <div className="max-w-2xl mx-auto p-4 mt-6">
                <div className="bg-blue-50 border border-blue-100 p-4 rounded-lg mb-8 text-sm text-blue-800 flex gap-3">
                    <Info className="shrink-0" size={20} />
                    <p>For each row, use the arrows (or drag) to rank the words from <strong>top (Most like you)</strong> to <strong>bottom (Least like you)</strong>.</p>
                </div>

                {currentQuestions.map(q => (
                    <DraggableRow 
                        key={q.id} 
                        question={q} 
                        currentOrder={answers[q.id]} 
                        onRankChange={handleRankChange} 
                    />
                ))}

                <div className="flex justify-end pt-8">
                    <button 
                        onClick={handleNext}
                        disabled={!canProceed}
                        className={`
                            px-8 py-3 rounded-lg font-semibold flex items-center gap-2 transition-all
                            ${canProceed 
                                ? 'bg-indigo-600 text-white shadow-lg hover:bg-indigo-700 hover:shadow-indigo-200' 
                                : 'bg-slate-200 text-slate-400 cursor-not-allowed'}
                        `}
                    >
                        {currentPage === totalPages - 1 ? "See Results" : "Next Page"}
                        <ChevronRight size={20} />
                    </button>
                </div>
            </div>
        </div>
    );
};

export default App;